// AP Loading.js
// pc.script.createLoadingScreen(function (app) {
//     var showSplash = function () {
//         var wrapper = document.createElement('div');
//         wrapper.id = 'application-splash-wrapper';
//         document.body.appendChild(wrapper);

//         var splash = document.createElement('div');
//         splash.id = 'application-splash';
//         wrapper.appendChild(splash);

//         var text = document.createElement('div');
//         text.id = 'splash-text';
//         text.innerText = 'ARCHITECTUURPRODUCTIES';
//         splash.appendChild(text);

//         var container = document.createElement('div');
//         container.id = 'progress-bar-container';
//         container.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2A10 10 0 1 0 22 12A10 10 0 0 0 12 2Zm0 18a8 8 0 1 1 8-8A8 8 0 0 1 12 20Z" opacity=".5"/><path fill="currentColor" d="M20 12h2A10 10 0 0 0 12 2V4A8 8 0 0 1 20 12Z"><animateTransform attributeName="transform" dur="1s" from="0 12 12" repeatCount="indefinite" to="360 12 12" type="rotate"/></path></svg>'
//         splash.appendChild(container);

//         const loadingText = document.createElement('p');
//         loadingText.id = 'loading-text';
//         loadingText.innerText = 'Model wordt ingeladen...';
//         splash.appendChild(loadingText);
//     };

//     var hideSplash = function () {
//         var splash = document.getElementById('application-splash-wrapper');
//         splash.parentElement.removeChild(splash);
//     };

//     var createCss = function () {
//         var css = [
//             'body { background-color: #73a6e0; font-family: sans-serif, Roboto; }',  // Background color
//             '#application-splash-wrapper { position: absolute; top: 0; left: 0; height: 100%; width: 100%; background-color: #73a6e0; }',  // Background color
//             '#application-splash { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; }',
//             '#splash-text { font-size: 24px; color: #FFF; margin-bottom: 1em; }',  // Increased margin-bottom for more space
//             '#loading-text { font-size: 0.8em; color: #FFF; margin-block: 2em; }',
//             '#progress-bar-container svg { color: #FFF; }',
//         ].join('\n');

//         var style = document.createElement('style');
//         style.type = 'text/css';
//         if (style.styleSheet) {
//             style.styleSheet.cssText = css;
//         } else {
//             style.appendChild(document.createTextNode(css));
//         }

//         document.head.appendChild(style);
//     };

//     createCss();
//     showSplash();

//     app.on('preload:end', function () {
//         hideSplash();
//     });
// });


var SplatLoader=pc.createScript("splatLoader");SplatLoader.prototype.initialize=function(){if(this.entity.gsplat){var s=this.app.assets.find("1SH_SpoorlaanGaussian2_ROI.compressed.ply"),a=this.app.assets.find("SpoorlaanGaussian2_ROI.compressed.ply"),e=function(s){this.entity.gsplat?this.entity.gsplat.asset=s:console.error("GSplat component missing when trying to assign asset.")}.bind(this);s.resource?e(s):(this.app.assets.load(s),s.once("load",(function(s){e(s),console.log("Low-res splat asset loaded.")}))),a.resource?e(a):(this.app.assets.load(a),a.once("load",(function(s){e(s),console.log("High-res splat asset swapped in!")})))}else console.error("Entity does not have a GSplat component. Please add one to use SplatLoader.")};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,r,s){e[0]=computeGaussian(0,s),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(SAMPLE_COUNT/2);i<a;i++){var u=computeGaussian(i+1,s);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=r*h,t[4*i+2]=-o*h,t[4*i+3]=-r*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets["+SAMPLE_COUNT+"];","uniform float uBlurWeights["+SAMPLE_COUNT+"];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),s=["varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,o,"BloomExtractShader",t),this.blurShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,r,"BloomBlurShader",t),this.combineShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,s,"BloomCombineShader",t),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,r=e.colorBuffer.height;if(o!==this.width||r!==this.height)for(this.width=o,this.height=r,this._destroy(),t=0;t<2;t++){var s=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:r>>1,mipmaps:!1});s.minFilter=pc.FILTER_LINEAR,s.magFilter=pc.FILTER_LINEAR,s.addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:s,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var r=this.device.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(this.targets[0],this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),this.drawQuad(this.targets[1],this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),this.drawQuad(this.targets[0],this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(t,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this.effect._destroy()}))};var TouchInput=pc.createScript("touchInput");TouchInput.attributes.add("orbitSensitivity",{type:"number",default:.4,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),TouchInput.attributes.add("distanceSensitivity",{type:"number",default:.2,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),TouchInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera,this.lastTouchPoint=new pc.Vec2,this.lastPinchMidPoint=new pc.Vec2,this.lastPinchDistance=0,this.orbitCamera&&this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.on("destroy",(function(){this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchStartEndCancel,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)})))},TouchInput.prototype.getPinchDistance=function(t,i){var o=t.x-i.x,n=t.y-i.y;return Math.sqrt(o*o+n*n)},TouchInput.prototype.calcMidPoint=function(t,i,o){o.set(i.x-t.x,i.y-t.y),o.scale(.5),o.x+=t.x,o.y+=t.y},TouchInput.prototype.onTouchStartEndCancel=function(t){var i=t.touches;1==i.length?this.lastTouchPoint.set(i[0].x,i[0].y):2==i.length&&(this.lastPinchDistance=this.getPinchDistance(i[0],i[1]),this.calcMidPoint(i[0],i[1],this.lastPinchMidPoint))},TouchInput.fromWorldPoint=new pc.Vec3,TouchInput.toWorldPoint=new pc.Vec3,TouchInput.worldDiff=new pc.Vec3,TouchInput.prototype.pan=function(t){var i=TouchInput.fromWorldPoint,o=TouchInput.toWorldPoint,n=TouchInput.worldDiff,h=this.entity.camera,c=this.orbitCamera.distance;h.screenToWorld(t.x,t.y,c,i),h.screenToWorld(this.lastPinchMidPoint.x,this.lastPinchMidPoint.y,c,o),n.sub2(o,i),this.orbitCamera.pivotPoint.add(n)},TouchInput.pinchMidPoint=new pc.Vec2,TouchInput.prototype.onTouchMove=function(t){var i=TouchInput.pinchMidPoint,o=t.touches;if(1==o.length){var n=o[0];this.orbitCamera.pitch-=(n.y-this.lastTouchPoint.y)*this.orbitSensitivity,this.orbitCamera.yaw-=(n.x-this.lastTouchPoint.x)*this.orbitSensitivity,this.lastTouchPoint.set(n.x,n.y)}else if(2==o.length){var h=this.getPinchDistance(o[0],o[1]),c=h-this.lastPinchDistance;this.lastPinchDistance=h,this.orbitCamera.distance-=c*this.distanceSensitivity*.1*(.1*this.orbitCamera.distance),this.calcMidPoint(o[0],o[1],i),this.pan(i),this.lastPinchMidPoint.copy(i)}};var OrbitCamera=pc.createScript("orbitCamera");OrbitCamera.attributes.add("autoRender",{type:"boolean",default:!0,title:"Auto Render",description:"Disable to only render when camera is moving (saves power when the camera is still)"}),OrbitCamera.attributes.add("distanceMax",{type:"number",default:0,title:"Distance Max",description:"Setting this at 0 will give an infinite distance limit"}),OrbitCamera.attributes.add("distanceMin",{type:"number",default:0,title:"Distance Min"}),OrbitCamera.attributes.add("pitchAngleMax",{type:"number",default:90,title:"Pitch Angle Max (degrees)"}),OrbitCamera.attributes.add("pitchAngleMin",{type:"number",default:-90,title:"Pitch Angle Min (degrees)"}),OrbitCamera.attributes.add("inertiaFactorDesktop",{type:"number",default:0,title:"Inertia Factor (Desktop)",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("inertiaFactorMobile",{type:"number",default:0,title:"Inertia Factor (Mobile)",description:"Higher value means that the camera will continue moving after the user has stopped dragging. 0 is fully responsive."}),OrbitCamera.attributes.add("focusEntity",{type:"entity",title:"Focus Entity",description:"Entity for the camera to focus on. If blank, then the camera will use the whole scene"}),OrbitCamera.attributes.add("frameOnStart",{type:"boolean",default:!0,title:"Frame on Start",description:'Frames the entity or scene at the start of the application."'}),Object.defineProperty(OrbitCamera.prototype,"inertiaFactor",{get:function(){return this._isMobile()?this.inertiaFactorMobile:this.inertiaFactorDesktop}}),Object.defineProperty(OrbitCamera.prototype,"distance",{get:function(){return this._targetDistance},set:function(t){this._targetDistance=this._clampDistance(t)}}),Object.defineProperty(OrbitCamera.prototype,"pitch",{get:function(){return this._targetPitch},set:function(t){this._targetPitch=this._clampPitchAngle(t)}}),Object.defineProperty(OrbitCamera.prototype,"yaw",{get:function(){return this._targetYaw},set:function(t){this._targetYaw=t;var i=(this._targetYaw-this._yaw)%360;this._targetYaw=i>180?this._yaw-(360-i):i<-180?this._yaw+(360+i):this._yaw+i}}),Object.defineProperty(OrbitCamera.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.copy(t)}}),OrbitCamera.prototype.focus=function(t){this._buildAabb(t,0);var i=this._modelsAabb.halfExtents,e=Math.max(i.x,Math.max(i.y,i.z));e/=Math.tan(.5*this.entity.camera.fov*pc.math.DEG_TO_RAD),e*=2,this.distance=e,this._removeInertia(),this._pivotPoint.copy(this._modelsAabb.center)},OrbitCamera.distanceBetween=new pc.Vec3,OrbitCamera.prototype.resetAndLookAtPoint=function(t,i){this.pivotPoint.copy(i),this.entity.setPosition(t),this.entity.lookAt(i);var e=OrbitCamera.distanceBetween;e.sub2(i,t),this.distance=e.length(),this.pivotPoint.copy(i);var a=this.entity.getRotation();this.yaw=this._calcYaw(a),this.pitch=this._calcPitch(a,this.yaw),this._removeInertia(),this._updatePosition(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype.resetAndLookAtEntity=function(t,i){this._buildAabb(i,0),this.resetAndLookAtPoint(t,this._modelsAabb.center)},OrbitCamera.prototype.reset=function(t,i,e){this.pitch=i,this.yaw=t,this.distance=e,this._removeInertia(),this.autoRender||(this.app.renderNextFrame=!0)},OrbitCamera.prototype._isMobile=function(){var t=navigator.userAgent||navigator.vendor||window.opera,i=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(t),e=this.app.touch&&this.app.touch.available&&(!this.app.mouse||window.innerWidth<=1024),a=window.innerWidth<=768||window.innerHeight<=768;return i||e&&a},OrbitCamera.prototype.initialize=function(){this._checkAspectRatio(),this._modelsAabb=new pc.BoundingBox,this._buildAabb(this.focusEntity||this.app.root,0),this.entity.lookAt(this._modelsAabb.center),this._pivotPoint=new pc.Vec3,this._pivotPoint.copy(this._modelsAabb.center),this._lastFramePivotPoint=this._pivotPoint.clone();var t=this.entity.getRotation();if(this._yaw=this._calcYaw(t),this._pitch=this._clampPitchAngle(this._calcPitch(t,this._yaw)),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0),this._distance=0,this._targetYaw=this._yaw,this._targetPitch=this._pitch,this.frameOnStart)this.focus(this.focusEntity||this.app.root);else{var i=new pc.Vec3;i.sub2(this.entity.getPosition(),this._pivotPoint),this._distance=this._clampDistance(i.length())}this._targetDistance=this._distance,this._autoRenderDefault=this.app.autoRender,this.app.autoRender&&(this.app.autoRender=this.autoRender),this.autoRender||(this.app.renderNextFrame=!0),this.on("attr:autoRender",(function(t,i){this.app.autoRender=t,this.autoRender||(this.app.renderNextFrame=!0)}),this),this.on("attr:distanceMin",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:distanceMax",(function(t,i){this._targetDistance=this._clampDistance(this._distance)}),this),this.on("attr:pitchAngleMin",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:pitchAngleMax",(function(t,i){this._targetPitch=this._clampPitchAngle(this._pitch)}),this),this.on("attr:focusEntity",(function(t,i){this.frameOnStart?this.focus(t||this.app.root):this.resetAndLookAtEntity(this.entity.getPosition(),t||this.app.root)}),this),this.on("attr:frameOnStart",(function(t,i){t&&this.focus(this.focusEntity||this.app.root)}),this);var onResizeCanvas=function(){this._checkAspectRatio(),this.autoRender||(this.app.renderNextFrame=!0)};this.app.graphicsDevice.on("resizecanvas",onResizeCanvas,this),this.on("destroy",(function(){this.app.graphicsDevice.off("resizecanvas",onResizeCanvas,this),this.app.autoRender=this._autoRenderDefault}),this)},OrbitCamera.prototype.update=function(t){if(!this.autoRender){var i=Math.abs(this._targetDistance-this._distance),e=Math.abs(this._targetYaw-this._yaw),a=Math.abs(this._targetPitch-this._pitch),s=this._lastFramePivotPoint.distance(this._pivotPoint);this.app.renderNextFrame=this.app.renderNextFrame||i>.01||e>.01||a>.01||s>0}var n=0===this.inertiaFactor?1:Math.min(t/this.inertiaFactor,1);this._distance=pc.math.lerp(this._distance,this._targetDistance,n),this._yaw=pc.math.lerp(this._yaw,this._targetYaw,n),this._pitch=pc.math.lerp(this._pitch,this._targetPitch,n),this._lastFramePivotPoint.copy(this._pivotPoint),this._updatePosition()},OrbitCamera.prototype._updatePosition=function(){this.entity.setLocalPosition(0,0,0),this.entity.setLocalEulerAngles(this._pitch,this._yaw,0);var t=this.entity.getPosition();t.copy(this.entity.forward),t.scale(-this._distance),t.add(this.pivotPoint),this.entity.setPosition(t)},OrbitCamera.prototype._removeInertia=function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance},OrbitCamera.prototype._checkAspectRatio=function(){var t=this.app.graphicsDevice.height,i=this.app.graphicsDevice.width;this.entity.camera.horizontalFov=t>i},OrbitCamera.prototype._buildAabb=function(t,i){var e,a=0,s=0;if(t instanceof pc.Entity){var n=[],r=t.findComponents("render");for(a=0;a<r.length;++a)if(e=r[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);var o=t.findComponents("model");for(a=0;a<o.length;++a)if(e=o[a].meshInstances)for(s=0;s<e.length;s++)n.push(e[s]);for(a=0;a<n.length;a++)0===i?this._modelsAabb.copy(n[a].aabb):this._modelsAabb.add(n[a].aabb),i+=1}for(a=0;a<t.children.length;++a)i+=this._buildAabb(t.children[a],i);return i},OrbitCamera.prototype._calcYaw=function(t){var i=new pc.Vec3;return t.transformVector(pc.Vec3.FORWARD,i),Math.atan2(-i.x,-i.z)*pc.math.RAD_TO_DEG},OrbitCamera.prototype._clampDistance=function(t){return this.distanceMax>0?pc.math.clamp(t,this.distanceMin,this.distanceMax):Math.max(t,this.distanceMin)},OrbitCamera.prototype._clampPitchAngle=function(t){return pc.math.clamp(t,-this.pitchAngleMax,-this.pitchAngleMin)},OrbitCamera.quatWithoutYaw=new pc.Quat,OrbitCamera.yawOffset=new pc.Quat,OrbitCamera.prototype._calcPitch=function(t,i){var e=OrbitCamera.quatWithoutYaw,a=OrbitCamera.yawOffset;a.setFromEulerAngles(0,-i,0),e.mul2(a,t);var s=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,s),Math.atan2(s.y,-s.z)*pc.math.RAD_TO_DEG};var MouseInput=pc.createScript("mouseInput");MouseInput.attributes.add("orbitSensitivity",{type:"number",default:.3,title:"Orbit Sensitivity",description:"How fast the camera moves around the orbit. Higher is faster"}),MouseInput.attributes.add("distanceSensitivity",{type:"number",default:.15,title:"Distance Sensitivity",description:"How fast the camera moves in and out. Higher is faster"}),MouseInput.prototype.initialize=function(){if(this.orbitCamera=this.entity.script.orbitCamera,this.orbitCamera){var t=this,onMouseOut=function(o){t.onMouseOut(o)};this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.addEventListener("mouseout",onMouseOut,!1),this.on("destroy",(function(){this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEWHEEL,this.onMouseWheel,this),window.removeEventListener("mouseout",onMouseOut,!1)}))}this.app.mouse.disableContextMenu(),this.lookButtonDown=!1,this.panButtonDown=!1,this.lastPoint=new pc.Vec2},MouseInput.fromWorldPoint=new pc.Vec3,MouseInput.toWorldPoint=new pc.Vec3,MouseInput.worldDiff=new pc.Vec3,MouseInput.prototype.pan=function(t){var o=MouseInput.fromWorldPoint,e=MouseInput.toWorldPoint,i=MouseInput.worldDiff,s=this.entity.camera,n=this.orbitCamera.distance;s.screenToWorld(t.x,t.y,n,o),s.screenToWorld(this.lastPoint.x,this.lastPoint.y,n,e),i.sub2(e,o),this.orbitCamera.pivotPoint.add(i)},MouseInput.prototype.onMouseDown=function(t){if("true"!==document.body.getAttribute("data-modal-open"))switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!0;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseUp=function(t){switch(t.button){case pc.MOUSEBUTTON_LEFT:this.lookButtonDown=!1;break;case pc.MOUSEBUTTON_MIDDLE:case pc.MOUSEBUTTON_RIGHT:this.panButtonDown=!1}},MouseInput.prototype.onMouseMove=function(t){pc.app.mouse;this.lookButtonDown?(this.orbitCamera.pitch-=t.dy*this.orbitSensitivity,this.orbitCamera.yaw-=t.dx*this.orbitSensitivity):this.panButtonDown&&this.pan(t),this.lastPoint.set(t.x,t.y)},MouseInput.prototype.onMouseWheel=function(t){this.orbitCamera.distance-=t.wheel*this.distanceSensitivity*(.1*this.orbitCamera.distance),t.event.preventDefault()},MouseInput.prototype.onMouseOut=function(t){this.lookButtonDown=!1,this.panButtonDown=!1};var KeyboardInput=pc.createScript("keyboardInput");KeyboardInput.prototype.initialize=function(){this.orbitCamera=this.entity.script.orbitCamera},KeyboardInput.prototype.postInitialize=function(){this.orbitCamera&&(this.startDistance=this.orbitCamera.distance,this.startYaw=this.orbitCamera.yaw,this.startPitch=this.orbitCamera.pitch,this.startPivotPosition=this.orbitCamera.pivotPoint.clone())},KeyboardInput.prototype.update=function(t){this.orbitCamera&&this.app.keyboard.wasPressed(pc.KEY_SPACE)&&(this.orbitCamera.reset(this.startYaw,this.startPitch,this.startDistance),this.orbitCamera.pivotPoint=this.startPivotPosition)};var TextBox=pc.createScript("textBox");TextBox.prototype.initialize=function(){const n=document.createElement("details");n.setAttribute("open",""),n.classList.add("textbox"),n.innerHTML="\n        <summary><h1></h1></summary>\n        <hr />\n        <p></p>\n    ";const t=document.createElement("style");t.innerHTML="\n    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');\n\n    .textbox {\n        position: fixed;\n        top: 1rem;\n        right: 1rem;\n        padding: 1rem 1.3rem;\n        border-radius: 10px;\n        background: rgba(0, 0, 0, 0.3);\n        backdrop-filter: blur(10px);\n        z-index: 100;\n        max-width: 300px;\n        box-sizing: border-box;\n        font-family: 'Poppins', 'sans-serif';\n        transition: opacity 300ms;\n    }\n    .textbox > summary {\n        list-style: none;\n    }\n    .textbox > summary::-webkit-details-marker {\n        display: none;\n    }\n    .textbox h1 {\n        font-size: 1.5rem;\n        margin: 0;\n        color: #f1fbfd;\n    }\n    .textbox hr {\n        border: 0;\n        height: 1px;\n        background-color: #a0afac;\n    }\n    .textbox p {\n        margin: 0;\n        margin-top: 0.3rem;\n        color: #e8f1f3;\n    }\n\n    @media (max-width: 700px) {\n        .textbox {\n            width: calc(100% - 20px);\n            max-width: 390px;\n            right: initial;\n            top: 10px;\n            left: 10px;\n            border-radius: 10px;\n        }\n        .textbox h1 {\n            font-size: 1.2rem;\n        }\n        .textbox p {\n            font-size: 14px;\n        }\n    }\n    ",document.body.appendChild(t),document.body.appendChild(n)},TextBox.prototype.update=function(n){};const sogsLoadedCache={};var Ui=pc.createScript("ui");function closeModal(){document.body.setAttribute("data-modal-open","false")}function openModal(){document.body.setAttribute("data-modal-open","true")}Ui.attributes.add("html",{type:"asset",assetType:"html"}),Ui.attributes.add("css",{type:"asset",assetType:"css"}),Ui.attributes.add("logo",{type:"asset"}),Ui.attributes.add("config",{type:"asset",assetType:"json"}),"undefined"!=typeof document&&document.body.setAttribute("data-splat-loaded","false"),Ui.prototype.initialize=function(){document.body.setAttribute("data-modal-open","true");const e=document.createElement("div");e.innerHTML=this.html.resource||"";const t=btoa(unescape(encodeURIComponent(this.logo.resource)));e.querySelector(".logo").src="data:image/svg+xml;base64,"+t;const o=this.config.resource;e.querySelectorAll("h1").forEach((e=>e.innerText=o.name)),e.querySelector(".description").innerText=o.description,e.querySelectorAll("button.start-viewer").forEach((e=>{e.onclick=closeModal})),e.querySelectorAll("button.open-modal").forEach((e=>{e.onclick=openModal})),document.body.appendChild(e);const s=document.createElement("style");s.type="text/css",s.textContent=this.css.resource||"",document.head.appendChild(s),this.css.on("load",(()=>{s.innerHTML=this.css.resource}))},pc.script.createLoadingScreen((e=>{const t=setInterval((()=>{0!==Object.values(sogsLoadedCache).length&&(document.querySelectorAll(".overlay [disabled]").forEach((e=>{e.removeAttribute("disabled")})),document.body.setAttribute("data-splat-loaded","true"),console.log("High-res splat asset loaded."),clearInterval(t))}),300)}));var Ui=pc.createScript("phasepicker");Ui.attributes.add("html",{type:"asset",assetType:"html"}),Ui.attributes.add("css",{type:"asset",assetType:"css"}),Ui.attributes.add("config",{type:"asset",assetType:"json"});let visibleProgress=.5,desiredProgress=.5,transitionInterval=null,currentIndex=0;function transitionStep(){const e=Math.abs(visibleProgress-desiredProgress)/10,t=Math.min(e,visibleProgress-e);visibleProgress<desiredProgress&&(visibleProgress+=t),visibleProgress>desiredProgress&&(visibleProgress-=t);Math.abs(visibleProgress-desiredProgress)<.004&&clearInterval(transitionInterval);const s=.98*visibleProgress;document.querySelector(".timeline stop.line[offset]").setAttribute("offset",s+(1-.98)/2),document.querySelectorAll(".timeline .step").forEach((e=>{const t=Number(e.getAttribute("data-progress"))-visibleProgress;e.classList[t<.03?"add":"remove"]("passed")}))}function transitionToProgress(e){transitionInterval&&clearInterval(transitionInterval),desiredProgress=e,transitionStep(),transitionInterval=setInterval(transitionStep,16)}function updateButtonStates(e){const t=currentIndex>0,s=currentIndex<e.steps.length-1;document.body.setAttribute("data-prev-visible",t),document.body.setAttribute("data-next-visible",s)}Ui.prototype.initialize=function(){const e=document.createElement("div");e.innerHTML=this.html.resource||"";const t=document.createElement("style");t.type="text/css",t.textContent=this.css.resource||"",document.head.appendChild(t),document.body.appendChild(e);const s=this.config.resource,r=e.querySelector(".timeline svg").getBoundingClientRect(),n=r.width/r.height,i=s.steps.length+1;for(const t of s.steps){const r=document.importNode(e.querySelector("template.step-template").content,!0),o=s.steps.indexOf(t)+1,a=o/i,c=Math.PI/2-a*Math.PI,l=32.5*Math.cos(-c)*n;r.querySelector("*").setAttribute("style",`--x: ${100*a}%; --bottom: ${l}px`),r.querySelector("h3").innerText=t.title,r.querySelector("h4").innerText=t.subtitle,r.querySelector("*").addEventListener("click",(()=>{transitionToProgress(a),this.app.fire("carousel:show-step",o-1),currentIndex=o-1,updateButtonStates(s)})),r.querySelector("*").setAttribute("data-progress",a),e.querySelector(".steps").appendChild(r)}const nextStep=()=>{if(currentIndex<s.steps.length-1){const e=currentIndex+1;transitionToProgress((e+1)/i),this.app.fire("carousel:show-step",e),currentIndex=e}updateButtonStates(s)},prevStep=()=>{if(currentIndex>0){const e=currentIndex-1;transitionToProgress((e+1)/i),this.app.fire("carousel:show-step",e),currentIndex=e}updateButtonStates(s)};e.querySelector(".step").click(),updateButtonStates(s),document.querySelectorAll(".prev").forEach((e=>{e.addEventListener("click",(()=>{prevStep()}))})),document.querySelectorAll(".next").forEach((e=>{e.addEventListener("click",(()=>{nextStep()}))})),window.addEventListener("keyup",(e=>{"ArrowLeft"===e.key&&prevStep(),"ArrowRight"===e.key&&nextStep()})),this.css.on("load",(()=>{t.innerHTML=this.css.resource})),this.html.on("load",(()=>{e.innerHTML=this.html.resource}))};var Carousel=pc.createScript("carousel");Carousel.attributes.add("config",{type:"asset",assetType:"json"}),Carousel.attributes.add("scaleFactor",{type:"number",min:0,max:1,default:1}),Carousel.attributes.add("vertexShader",{type:"asset",assetType:"shader"}),Carousel.attributes.add("fragmentShader",{type:"asset",assetType:"shader"}),Carousel.attributes.add("camera",{type:"entity"});const a="gl_FragColor = vec4(gammaCorrectOutput(toneMap(processEnvironment(linear))), 1.0);",b="gl_FragColor = vec4(gammaCorrectOutput(toneMap(processEnvironment(linear))), 0.0);";pc.shaderChunks.skyboxPS=pc.shaderChunks.skyboxPS.replace(a,b),Carousel.prototype.initialize=function(){this.app.assets;const e=window.innerWidth<800;console.log(this.app.root,123),this.sogs=this.config.resource.steps.map((t=>({step:t,entity:this.app.root.findByName(t.sogs[e?"mobile":"desktop"])}))),console.log(this.sogs),this.currentIndex=-1,this.app.on("carousel:show-step",this.showStep,this),this.app.graphicsDevice.scope.resolve("scaleFactor").setValue(this.scaleFactor),this.on("attr",((e,t,s)=>{"scaleFactor"===e&&this.app.graphicsDevice.scope.resolve("scaleFactor").setValue(this.scaleFactor)}))},Carousel.prototype.postInitialize=function(){this.showStep(0)},Carousel.prototype.loadSogsAssets=function(e,t){return new Promise((t=>{if(sogsLoadedCache[e])return void t();this.app.assets;const s=this.sogs.find((t=>t.entity.name===e)),o=[];let i=setInterval((()=>{o.find((e=>!e.loaded))||(clearInterval(i),s.entity.enabled=!0,setTimeout((()=>{s.entity.enabled=!1,sogsLoadedCache[e]=!0,t()}),1e3))}),20)}))},Carousel.prototype.showStep=function(e){this.currentIndex=e,console.log("SHOW STEP: INDEX",e),this.sogs.forEach((async(e,t)=>{if(e.entity)if(console.log(t,this.currentIndex),await this.loadSogsAssets(e.entity.name,e),t==this.currentIndex){e.entity.enabled=!0;const t=this.config.resource.steps.find((t=>t.sogs.desktop===e.entity.name||t.sogs.mobile===e.entity.name));document.querySelector(".textbox h1").innerText=t.copy?.title||"",document.querySelector(".textbox p").innerText=t.copy?.description||"",document.querySelector(".mobile h2").innerText=t.title,document.querySelector(".mobile p").innerText=t.subtitle}else e.entity.enabled=!1})),console.log(this.sogs.map((e=>e.entity?.enabled)))},Carousel.prototype.update=function(e){if(this.currentIndex>=0&&this.timer>2.5){const e=this.app.assets;e.load(this.sogs[this.calcNext()].asset),e.load(this.sogs[this.calcPrev()].asset)}this.timer+=e};